Here's a refined version of your Readme for the "Hazel" project, designed to encapsulate the professional and engaging tone typical of Clojure or Datomic documentation:

---

# Hazel

**Hazel** is an innovative proof of concept that explores the adaptation of [Datomic](https://www.datomic.com/) principles within frontend environments. This project introduces a JavaScript-based peer library capable of navigating and caching segments of a [DataScript](https://github.com/tonsky/datascript/) database directly in the browser. Such capability is instrumental for productivity tools like Asana, Jira, Slack, and Notion, especially those managing substantial datasets in the browser without backend access.

Built on the robust React TodoMVC framework, Hazel seeks to reinvent frontend data interactions with the following capabilities:

- **Lazy Iteration:** Fetch database segments on-demand from the backend, allowing progressive data handling.
- **Persistent Caching:** Store segments long-term within the browser cache.
- **Consistent Snapshots:** Obtain stable database snapshots for reliable data management.

For those new to Datomic-like systems, consider a typical scenario in relational databases like PostgreSQL or MySQL. Here, data lives on the server, and queries are server-bound, often reducing cached query results to mere key-value storage. In contrast, Hazel’s approach supports executing comprehensive queries within applications using local caches.

Further insights into these principles can be found in the [Datomic Introduction](https://docs.datomic.com/datomic-overview.html).

## How Hazel Works

Familiarity with the DataScript or Datomic data model is essential. For foundational knowledge, consider these resources:

- [Information Model](https://docs.datomic.com/datomic-overview.html#information-model)
- [Indexes](https://docs.datomic.com/datomic-overview.html#indexes)

Data in a DataScript database is organized into triples known as datoms, each comprising an entity, attribute, and value (E, A, V). These are maintained across three main indices: EAV, AEV, and AVE, minus the Transaction ID (T) present in Datomic. Hazel omits this component. These indices form persistent B+ tree structures where each tree node represents a storage segment.

Database modifications occur via transactions—sets of datoms marked for addition or removal. DataScript employs a strategy to buffer changes until they match the size of a tree node for optimal tree reconstruction. Hazel efficiently navigates these segments and transaction tails, offering APIs akin to Datomic’s low-level interfaces:

- `seek-datoms`
- `datoms`

In Clojure/Script, these methods yield lazy collections. Hazel leverages JavaScript’s AsyncGenerators to support asynchronous, lazy sequences due to network-based segment retrieval.

## Exploring Hazel's Architecture

Hazel operates by engaging frontend applications with DataScript database segments, products of processing transactions. This involves interacting with indices stored as persistent B+ trees.

- **Branch Nodes:** Maintain ordered sequences of keys and node addresses for tree navigation.
- **Leaf Nodes:** Store ordered sequences of keys, reflecting datoms.

Refer to the [persistent sorted set documentation](https://github.com/tonsky/persistent-sorted-set#durability) for additional details, and explore [Datomic's data model documentation](https://docs.datomic.com/whatis/data-model.html#datalog) for architectural context.

## Current Limitations

Currently, Hazel implements the `seek-datoms` and `datoms` index methods. A significant challenge lies in access control. For instance, in collaborative projects like those on Asana, access control becomes complex when databases are cached locally. Two potential solutions include:

1. Backend-based query APIs to handle access control, albeit at the cost of caching benefits.
2. Database segmentation that replicates tasks across multiple databases to enforce data limitations.

Feedback and discussions are encouraged, and contributions are welcomed through issues on our repository.

## Future Directions

Potential enhancements include implementing advanced Datomic/DataScript APIs and adapting the approach for local-first paradigms, such as Conflict-free Replicated Data Types (CRDTs) executed through JavaScript functions.

## Running Hazel

Launch Hazel using Docker with the following steps:

```bash
docker build -t hazel . && docker run --rm -p 8080:8080 hazel
open http://localhost:8080
```

## Developer Notes

Execute tests with:

```bash
bun run test
```

Please note that Bun builder is in beta. Current limitations include incomplete file reloads and a lack of automatic `manifest.json` generation.

---

This version aims to capture the clarity, precision, and engaging narrative style akin to technical documents for Clojure and Datomic, while ensuring coherence and readability throughout.
